<%# app/views/products/show.html.erb %>

<div class="product-page">
  <main class="product-container">
    <% if @product.present? %>
      <div class="product-show grid">
        <div class="left">
          <% image_url_for_page =
                case @product&.slug
                when "luxe-bed-linen"
                  "https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&w=1200&q=80"
                when "designer-throw-pillow"
                  "https://shoppersfortune.com/cdn/shop/files/ShoppersFortuneCottonFeelDesignerThrowPillowDecorativeCushionCovers-CuteOwls_FloraSetof5A.jpg?v=1689257687"
                # when "oak-coffee-table"
                #   "https://funky-chunky-furniture.co.uk/cdn/shop/products/salters-oak-coffee-table-33777-1-p.jpg?v=1643646322"
                else
                  nil
                end %>

          <% if image_url_for_page.present? %>
            <img src="<%= image_url_for_page %>" alt="<%= @product.name %>" class="product-show-image" />
          <% elsif @product.respond_to?(:image_url) && @product.image_url.present? %>
            <img src="<%= @product.image_url %>" alt="<%= @product.name %>" class="product-show-image" />
          <% elsif @product.respond_to?(:image) && @product.image.respond_to?(:attached?) && @product.image.attached? %>
            <%= image_tag url_for(@product.image), alt: @product.name, class: "product-show-image" %>
          <% else %>
            <div class="placeholder-image large">No image</div>
          <% end %>
        </div>

        <div class="right">
          <h1><%= @product.name %></h1>

          <% if @product.respond_to?(:price) && @product.price.present? %>
            <p class="price">
              Rs.<%= number_with_precision(@product.price, precision: 2) %>
            </p>
          <% elsif @product.respond_to?(:price_cents) && @product.price_cents.present? %>
            <p class="price">
              Rs.<%= number_with_precision(BigDecimal(@product.price_cents) / 100, precision: 2) %>
            </p>
          <% end %>

          <div class="product-meta-row">
            <% if @product.respond_to?(:category) && @product.category.present? %>
              <span class="product-meta-pill"><%= @product.category.name %></span>
            <% end %>
            <% if @product.respond_to?(:sku) && @product.sku.present? %>
              <span class="product-meta-pill">SKU: <%= @product.sku %></span>
            <% end %>
          </div>

          <div class="description">
            <%= simple_format(@product.description.to_s) %>
          </div>

          <%= form_with url: cart_add_item_path, method: :post, local: true, html: { class: "add-to-cart" } do |f| %>
            <%= hidden_field_tag :product_id, @product.id %>
            <%= number_field_tag :quantity, 1, min: 1, class: "qty-input" %>
            <%= f.submit "Add to cart", class: "btn btn-primary" %>
          <% end %>

          <div style="margin-top: 0.75rem;">
            <% back_path =
                 if request.referer.present? && URI(request.referer).path != request.path
                   request.referer
                 else
                   products_path
                 end %>
            <%= link_to "Back", back_path, class: "btn btn-secondary" %>
          </div>
        </div>
      </div>
    <% else %>
      <div class="not-found">
        <h2>Product not found</h2>
        <p>The product you requested doesn't exist or has been removed.</p>
        <%= link_to "Back to products", products_path, class: "btn btn-secondary" %>
      </div>
    <% end %>
  </main>
</div>