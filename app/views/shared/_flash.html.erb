<% flash.each do |type, message| %>
  <% next if type.to_s == "welcome" %>
  <% # Pick Tailwind classes and icon based on the type
     color, icon =
      case type.to_sym
      when :notice
        ["bg-green-100 border-green-500 text-green-800", "fa-solid fa-circle-check text-green-500"]
      when :alert, :error
        ["bg-red-100 border-red-500 text-red-800", "fa-solid fa-triangle-exclamation text-red-500"]
      else
        ["bg-indigo-100 border-indigo-500 text-indigo-800", "fa-solid fa-info-circle text-indigo-500"]
      end
  %>
  <div
    class="flash max-w-lg mx-auto mt-6 flex items-center gap-4 border-l-4 rounded-xl shadow-lg p-4 animate-fade-in transition-opacity duration-500 mb-2 <%= color %>"
    role="status" aria-live="polite" data-auto-dismiss="5000">
    <i class="<%= icon %> text-2xl"></i>
    <span class="flex-1 font-semibold"><%= message %></span>
    <button type="button" class="flash__close hover:text-gray-500 text-xl px-2 bg-transparent" aria-label="Dismiss message">&times;</button>
  </div>
<% end %>

<style>

  .animate-fade-in { animation: fadeIn .5s cubic-bezier(.4,0,.2,1); }
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-12px);}
    to   { opacity: 1; transform: translateY(0);}
  }
  .flash--hidden { opacity: 0 !important; pointer-events: none; transition: opacity .5s; }
</style>

<script>
  (function() {
    document.querySelectorAll('.flash').forEach(function(flashEl) {
      var autoMs = parseInt(flashEl.dataset.autoDismiss || 5000, 10);

      // Manual close
      var btn = flashEl.querySelector('.flash__close');
      if (btn) {
        btn.addEventListener('click', function() { hideFlash(flashEl); });
      }

      // Auto dismiss timer
      if (autoMs > 0) {
        setTimeout(function() { hideFlash(flashEl); }, autoMs);
      }
    });

    function hideFlash(el) {
      el.classList.add('flash--hidden');
      setTimeout(function() {
        if (el && el.parentNode) el.parentNode.removeChild(el);
      }, 500);
    }
  })();
</script>