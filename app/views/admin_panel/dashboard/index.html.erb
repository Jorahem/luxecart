<%# --- Topbar --- %>
<div class="flex flex-row items-center justify-between px-6 pt-4 pb-2">
  <div class="font-bold text-lg text-white tracking-tight flex flex-row items-center gap-2">
    <i class="fa-solid fa-gem text-indigo-400 text-2xl"></i>
    LuxeCart Admin
  </div>
  <div class="flex flex-row items-center gap-4">
    <div class="relative"><!-- Global search -->
      <input class="bg-gray-800 border border-gray-600 rounded-lg py-1.5 px-3 text-white focus:ring focus:ring-indigo-400 focus:outline-none" placeholder="Search orders, users, products..." />
    </div>
    <div>
      <button class="relative text-gray-300 hover:text-yellow-300"><i class="fa-solid fa-bell"></i></button>
      <%# Notification badge with unread count here %>
    </div>
    <div>
      <button class="flex items-center gap-2 bg-gray-800 hover:bg-gray-700 rounded px-4 py-1.5">
        <i class="fa-solid fa-user-shield text-indigo-300"></i>
        <span class="text-white font-medium"><%= current_admin.email %></span>
        <i class="fa-solid fa-chevron-down text-xs text-gray-500"></i>
      </button>
    </div>
  </div>
</div>

<div class="flex flex-row">
  <%# --- Sidebar --- %>
  <div class="hidden lg:flex flex-col w-48 min-h-screen bg-gray-800 pt-8">
    <nav class="flex flex-col gap-2 text-gray-200">
      <%= link_to admin_dashboard_path, class: "pl-6 py-3 hover:bg-indigo-800 rounded-r-xl font-semibold #{'bg-indigo-800' if request.path == admin_dashboard_path}" do %>
        <i class="fa-solid fa-gauge-high mr-3"></i> Dashboard
      <% end %>
      <%= link_to admin_orders_path, class: "pl-6 py-3 hover:bg-indigo-700 rounded-r-xl" do %>
        <i class="fa-solid fa-receipt mr-3"></i> Orders
      <% end %>
      <%= link_to admin_products_path, class: "pl-6 py-3 hover:bg-indigo-700 rounded-r-xl" do %>
        <i class="fa-solid fa-box mr-3"></i> Products
      <% end %>
      <%= link_to admin_categories_path, class: "pl-6 py-3 hover:bg-indigo-700 rounded-r-xl" do %>
        <i class="fa-solid fa-list mr-3"></i> Categories
      <% end %>
      <%= link_to admin_users_path, class: "pl-6 py-3 hover:bg-indigo-700 rounded-r-xl" do %>
        <i class="fa-solid fa-users mr-3"></i> Customers
      <% end %>
      <%= link_to admin_payments_path, class: "pl-6 py-3 hover:bg-indigo-700 rounded-r-xl" do %>
        <i class="fa-solid fa-credit-card mr-3"></i> Payments
      <% end %>
      <%= link_to admin_reports_path, class: "pl-6 py-3 hover:bg-indigo-700 rounded-r-xl" do %>
        <i class="fa-solid fa-chart-line mr-3"></i> Reports
      <% end %>
      <%= link_to admin_settings_path, class: "pl-6 py-3 hover:bg-indigo-700 rounded-r-xl" do %>
        <i class="fa-solid fa-gear mr-3"></i> Settings
      <% end %>
    </nav>
  </div>

  <%# --- Main Content Panel --- %>
  <main class="flex-1 px-4 md:px-10 py-8">
    <%# --- KPI Cards --- %>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
      <div class="bg-gray-800 rounded-xl p-5 flex flex-col items-center shadow group hover:scale-105 transition">
        <div class="text-gray-400 flex items-center gap-1 text-sm"><i class="fa-solid fa-sack-dollar"></i> Total Revenue</div>
        <div class="text-3xl font-extrabold text-green-300">
          Rs <%= number_with_precision(Order.sum(:total_price), precision: 2, delimiter: ',') %>
        </div>
        <div class="text-xs mt-2 text-green-500">+4.2% today</div>
      </div>
      <div class="bg-gray-800 rounded-xl p-5 flex flex-col items-center shadow group hover:scale-105 transition">
        <div class="text-gray-400 flex items-center gap-1 text-sm"><i class="fa-solid fa-box"></i> Orders Today</div>
        <div class="text-3xl font-extrabold text-indigo-300"><%= Order.where('DATE(created_at) = ?', Date.today).count %></div>
        <div class="text-xs mt-2 text-indigo-400">Click to view</div>
      </div>
      <div class="bg-gray-800 rounded-xl p-5 flex flex-col items-center shadow group hover:scale-105 transition">
        <div class="text-gray-400 flex items-center gap-1 text-sm"><i class="fa-solid fa-users"></i> Active Customers</div>
        <div class="text-3xl font-extrabold text-blue-400"><%= User.where('last_sign_in_at > ?', 7.days.ago).count %></div>
        <div class="text-xs mt-2 text-blue-400">Past 7d</div>
      </div>
      <div class="bg-gray-800 rounded-xl p-5 flex flex-col items-center shadow group hover:scale-105 transition">
        <div class="text-gray-400 flex items-center gap-1 text-sm"><i class="fa-solid fa-percent"></i> Conversion Rate</div>
        <div class="text-3xl font-extrabold text-yellow-300">3.7%</div>
        <div class="text-xs mt-2 text-yellow-400">View details</div>
      </div>
    </div>

    <%# --- Revenue Chart Placeholder section --- %>
    <div class="bg-gray-800 rounded-xl shadow p-6 mb-8 flex flex-col md:flex-row gap-6">
      <div class="flex-1 min-w-0">
        <h2 class="text-white font-semibold mb-4">Revenue (Last 30 days)</h2>
        <div class="h-36 flex items-center justify-center text-gray-400 text-sm bg-gray-900 rounded-xl">
          (Chart: Use Chartkick, Chart.js, or Rails chart gem!)
        </div>
      </div>
      <div class="flex-1 min-w-0">
        <h2 class="text-white font-semibold mb-4">Orders vs Payments</h2>
        <div class="h-36 flex items-center justify-center text-gray-400 text-sm bg-gray-900 rounded-xl">
          (Chart: Orders, Payments trends)
        </div>
      </div>
    </div>

    <%# --- Live Orders Feed --- %>
    <div class="bg-gray-800 rounded-xl shadow p-6 mb-8">
      <h2 class="text-white font-semibold text-xl mb-3">Live Activity Feed</h2>
      <ul class="flex flex-col gap-2">
        <% Order.order(created_at: :desc).limit(6).each do |o| %>
          <li class="flex gap-3 items-center">
            <span class="text-green-400">
              <i class="fa-solid fa-bolt"></i>
            </span>
            <span>
              <strong>Order <%= o.id %></strong> (<%= o.user&.email || "Guest" %>)
              placed <%= time_ago_in_words(o.created_at) %> ago, Rs <%= number_with_precision(o.total_price, precision: 2) %>
              <span class="ml-2 px-2 py-0.5 rounded-full text-xs bg-gray-700 text-indigo-200 font-semibold"><%= o.status.to_s.capitalize rescue o[:status].to_s.capitalize %></span>
            </span>
            <%= link_to "View", admin_order_path(o), class: "ml-auto text-blue-300 hover:underline text-xs" %>
          </li>
        <% end %>
      </ul>
    </div>

    <%# --- Action Required Panel --- %>
    <div class="bg-gray-800 rounded-xl shadow p-6 mb-8">
      <h2 class="text-white font-semibold text-xl mb-3">Action Required</h2>
      <ul class="flex flex-col gap-2">
        <% low_stock = Product.where("stock < ?", 10).count %>
        <% failed_payments = Payment.where(status: "failed").where('created_at > ?', 1.day.ago).count rescue 0 %>
        <% pending_orders = Order.where(status: [0, "pending"]).where('created_at < ?', 2.days.ago).count rescue 0 %>
        <% if low_stock > 0 %>
          <li class="text-yellow-400 font-bold"><i class="fa-solid fa-triangle-exclamation"></i> <%= low_stock %> products low in stock</li>
        <% end %>
        <% if failed_payments > 0 %>
          <li class="text-red-400 font-bold"><i class="fa-solid fa-ban"></i> <%= failed_payments %> payments failed today</li>
        <% end %>
        <% if pending_orders > 0 %>
          <li class="text-orange-400 font-bold"><i class="fa-solid fa-hourglass-half"></i> <%= pending_orders %> orders pending over 48 hours</li>
        <% end %>
        <% if low_stock == 0 && failed_payments == 0 && pending_orders == 0 %>
          <li class="text-green-400"><i class="fa-solid fa-circle-check"></i> All systems normal</li>
        <% end %>
      </ul>
    </div>

    <%# --- Business Intelligence Widgets --- %>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
  





<div class="bg-gray-800 rounded-xl shadow p-6 h-full">
  <h2 class="text-white font-semibold text-xl mb-3">Top Selling Products</h2>
  <ul>
    <% Product.left_joins(:order_items).group(:id).order('COUNT(order_items.id) DESC').limit(5).each do |prod| %>
      <li class="flex items-center gap-3 py-2 border-b border-gray-700">
        <span class="w-12 h-12 bg-gray-700 flex items-center justify-center rounded overflow-hidden">
          <% if prod.image_url.present? %>
            <%= image_tag(prod.image_url, class: "w-12 h-12 object-cover rounded") %>
          <% else %>
            <i class="fa-solid fa-image text-gray-500 text-2xl"></i>
          <% end %>
        </span>
        <div>
          <div class="text-indigo-200 font-bold"><%= prod.name %></div>
          <div class="text-gray-400 text-xs">
            Units sold: <%= prod.order_items.count %> /
            Revenue: Rs <%= number_with_precision(prod.order_items.sum(:unit_price), precision: 2) %>
          </div>
        </div>
      </li>
    <% end %>
  </ul>
</div>





    
      <div class="bg-gray-800 rounded-xl shadow p-6 h-full">
        <h2 class="text-white font-semibold text-xl mb-3">Top Categories</h2>
        <ul>
          <% Category.left_joins(:products).group(:id).order('COUNT(products.id) DESC').limit(5).each do |cat| %>
            <li class="flex items-center gap-3 py-2 border-b border-gray-700">
              <span class="font-bold text-yellow-300"><%= cat.name %></span>
              <div class="flex-1 h-2 bg-gray-600 rounded ml-4 mr-2">
                <div class="bg-indigo-400 h-2 rounded" style="width: <%= (cat.products.count.to_f / Product.count * 100).round %>%"></div>
              </div>
              <span class="text-xs text-gray-300"><%= (cat.products.count.to_f / Product.count * 100).round(1) %>%</span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>

    <%# --- Quick Actions Button (Floating!) --- %>
    <div class="fixed bottom-10 right-10 z-50">
      <div class="flex flex-col gap-3">
        <%= link_to "+ Add Product", new_admin_product_path, class: "bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-3 rounded-lg shadow font-bold transition" %>
        <%= link_to "+ Create Category", new_admin_category_path, class: "bg-yellow-500 hover:bg-yellow-600 text-black px-5 py-3 rounded-lg shadow font-bold transition" %>
        <%= link_to "View Today's Orders", admin_orders_path(q: { created_at_gteq: Date.today }), class: "bg-green-500 hover:bg-green-600 text-black px-5 py-3 rounded-lg shadow font-bold transition" %>
      </div>
    </div>
  </main>
</div>