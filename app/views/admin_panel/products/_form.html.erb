<%= form_with model: [:admin, @product], local: true do |f| %>
  
  <% if @product.errors.any? %>
    <div class="mb-6 rounded-xl bg-red-50 border border-red-200 p-4">
      <h3 class="text-sm font-bold text-red-800 mb-2">
        <%= pluralize(@product.errors.count, "error") %> prohibited this product from being saved:
      </h3>
      <ul class="list-disc list-inside text-sm text-red-700">
        <% @product.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-5">
    <!-- Name -->
    <div>
      <label class="block text-xs font-semibold text-slate-300 mb-2">Name *</label>
      <%= f.text_field :name,
            required: true,
            class: "w-full px-4 py-3 rounded-xl bg-white border border-white/10 text-black placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
    </div>

    <!-- Description -->
    <div>
      <label class="block text-xs font-semibold text-slate-300 mb-2">Description *</label>
      <%= f.text_area :description,
            rows: 4,
            required: true,
            class: "w-full px-4 py-3 rounded-xl bg-white border border-white/10 text-black placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
    </div>

    <!-- Category & Brand (side by side with Add New buttons) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-xs font-semibold text-slate-300 mb-2">Category *</label>
        <div class="flex gap-2">
          <%= f.collection_select :category_id,
                Category.order(:name),
                :id,
                :name,
                { prompt: "Select category" },
                { required: true, class: "flex-1 px-4 py-3 rounded-xl bg-white border border-white/10 text-black focus:outline-none focus:ring-2 focus:ring-indigo-500" } %>
          <%= link_to new_admin_category_path,
                target: "_blank",
                class: "px-4 py-3 rounded-xl bg-gradient-to-r from-emerald-500  to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-black font-bold shadow-lg transition-all duration-200 flex items-center gap-2",
                title: "Add New Category (opens in new tab)" do %>
            <i class="fas fa-plus"></i>
            <span class="hidden lg:inline">Add</span>
          <% end %>
        </div>
        <p class="text-xs text-slate-400 mt-1 ">
          <i class="fas fa-info-circle"></i>
          Can't find your category? Click "Add" to create a new one
        </p>
      </div>

      <div>
        <label class="block text-xs font-semibold text-slate-300 mb-2">Brand *</label>
        <div class="flex gap-2">
          <%= f.collection_select :brand_id,
                Brand.order(:name),
                :id,
                :name,
                { prompt: "Select brand" },
                { required: true, class: "flex-1 px-4 py-3 rounded-xl bg-white border border-white/10 text-black focus:outline-none focus:ring-2 focus:ring-indigo-500" } %>
          <%= link_to new_admin_brand_path,
                target: "_blank",
                class: "px-4 py-3 rounded-xl bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white font-bold shadow-lg transition-all duration-200 flex items-center gap-2",
                title: "Add New Brand (opens in new tab)" do %>
            <i class="fas fa-plus"></i>
            <span class="hidden lg:inline">Add</span>
          <% end %>
        </div>
        <p class="text-xs text-slate-400 mt-1">
          <i class="fas fa-info-circle"></i>
          Can't find your brand? Click "Add" to create a new one
        </p>
      </div>
    </div>

    <!-- Quick refresh notice -->
    <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
      <div class="flex items-start gap-3">
        <i class="fas fa-lightbulb text-blue-600 text-lg mt-0.5"></i>
        <div>
          <p class="text-sm font-bold text-blue-900">Quick Tip!</p>
          <p class="text-xs text-blue-700 mt-1">
            After adding a new category or brand in the popup, refresh this page to see it in the dropdown.
          </p>
        </div>
      </div>
    </div>

    <!-- Price & Stock (side by side) -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-xs font-semibold text-slate-300 mb-2">Price *</label>
        <%= f.number_field :price,
              step: 0.01,
              min: 0,
              required: true,
              placeholder: "0.00",
              class: "w-full px-4 py-3 rounded-xl bg-white border border-white/10 text-black focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      </div>

      <div>
        <label class="block text-xs font-semibold text-slate-300 mb-2">Stock Quantity *</label>
        <%= f.number_field :stock_quantity,
              min: 0,
              required: true,
              placeholder: "0",
              class: "w-full px-4 py-3 rounded-xl bg-white border border-white/10 text-black focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      </div>
    </div>

    <!-- SKU -->
    <div>
      <label class="block text-xs font-semibold text-slate-300 mb-2">SKU *</label>
      <%= f.text_field :sku,
            required: true,
            placeholder: "e.g., PROD-001",
            class: "w-full px-4 py-3 rounded-xl bg-white border border-white/10 text-black placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      <p class="text-xs text-slate-400 mt-1">
        <i class="fas fa-barcode"></i>
        Unique identifier for inventory tracking
      </p>
    </div>

    <!-- Image URL -->
    <div>
      <label class="block text-xs font-semibold text-slate-300 mb-2">Image URL</label>
      <%= f.text_field :image_url,
            placeholder: "https://example.com/image.jpg",
            class: "w-full px-4 py-3 rounded-xl bg-white border border-white/10 text-black placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-indigo-500" %>
      <p class="text-xs text-slate-400 mt-1">
        <i class="fas fa-image"></i>
        Enter a direct URL to the product image
      </p>
    </div>

    <!-- Status (Visibility Control) -->
    <div>
      <label class="block text-xs font-semibold text-slate-300 mb-2">Status *</label>
      <%= f.select :status,
            options_for_select(
              [
                ['Active (Visible to customers)', 'active'],
                ['Draft (Hidden from customers)', 'draft'],
                ['Archived (Hidden and discontinued)', 'archived']
              ],
              @product.status || 'active'
            ),
            {},
            { required: true, class: "w-full px-4 py-3 rounded-xl bg-white border border-white/10 text-black focus:outline-none focus:ring-2 focus:ring-indigo-500" } %>
      <p class="text-xs text-slate-400 mt-1">
        <i class="fas fa-eye"></i>
        <span class="font-semibold text-green-400">Active</span> products are visible on your store
      </p>
    </div>

    <!-- Buttons -->
    <div class="flex items-center gap-3 pt-4">
      <%= f.submit (@product.new_record? ? "Create Product" : "Update Product"),
            class: "px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold shadow-lg cursor-pointer transition-all duration-200" %>

      <%= link_to admin_products_path, class: "px-6 py-3 rounded-xl border-2 border-white/20 bg-white/10 hover:bg-white/20 text-sm font-semibold text-black transition-all duration-200" do %>
        <i class="fas fa-times"></i>
        Cancel
      <% end %>
    </div>
  </div>
<% end %>