<main class="px-4 py-10 min-h-screen" style="background: linear-gradient(115deg, #e0e7ff 60%, #f3e8ff 100%);">
  <div class="max-w-6xl mx-auto">

    <!-- Header -->
    <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6 mb-8">
      <div>
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-cyan-400 to-indigo-400 text-xs font-bold text-black mb-4 shadow">
          <i class="fa-solid fa-users text-black"></i>
          <span>People & Access</span>
        </div>
        <h1 class="text-3xl md:text-4xl font-extrabold text-indigo-700 tracking-tight mb-2">Users</h1>
        <p class="text-base text-blue-900 mt-1 max-w-2xl font-medium">
          Manage admin, staff, and customer accounts with ease.
        </p>
      </div>
      <div class="flex items-center gap-3">
        <%= link_to admin_dashboard_path,
              class: "px-5 py-2 rounded-xl bg-gradient-to-r from-gray-300 to-gray-100 text-gray-800 text-sm font-bold
                 shadow flex items-center gap-2 hover:from-blue-100 hover:to-indigo-100 transition" do %>
          <i class="fas fa-arrow-left text-black"></i> Back
        <% end %>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-5 mb-8">
      <div class="rounded-2xl shadow border-0 p-6 bg-gradient-to-bl from-blue-100 via-indigo-100 to-purple-200 relative overflow-hidden">
        <div class="absolute -top-10 -right-10 h-32 w-32 bg-blue-400/30 blur-3xl"></div>
        <div class="text-sm font-semibold text-indigo-700">Total Users</div>
        <div class="text-3xl font-black mt-2 text-indigo-900"><%= @users.count %></div>
        <div class="text-xs text-blue-600 mt-2">All time</div>
      </div>
      <div class="rounded-2xl shadow border-0 p-6 bg-gradient-to-bl from-green-100 via-emerald-100 to-cyan-200 relative overflow-hidden">
        <div class="absolute -top-10 -right-10 h-32 w-32 bg-emerald-400/20 blur-3xl"></div>
        <div class="text-sm font-semibold text-emerald-700">Privileged</div>
        <div class="text-3xl font-black mt-2 text-emerald-900">
          <% if defined?(User) && User.column_names.include?("role") %>
            <%= User.where(role: %w[admin ceo staff]).count %>
          <% else %>
            <%= User.where(admin: true).count rescue 0 %>
          <% end %>
        </div>
        <div class="text-xs text-emerald-600 mt-2">Admin/CEO/Staff</div>
      </div>
      <div class="rounded-2xl shadow border-0 p-6 bg-gradient-to-bl from-yellow-200 via-yellow-100 to-amber-200 relative overflow-hidden">
        <div class="absolute -top-10 -right-10 h-32 w-32 bg-yellow-300/30 blur-3xl"></div>
        <div class="text-sm font-semibold text-yellow-700">Blocked</div>
        <div class="text-3xl font-black mt-2 text-yellow-900">
          <%= User.where(blocked: true).count rescue 0 %>
        </div>
        <div class="text-xs text-yellow-700 mt-2">Cannot sign in</div>
      </div>
      <div class="rounded-2xl shadow border-0 p-6 bg-gradient-to-bl from-pink-200 via-fuchsia-100 to-indigo-100 relative overflow-hidden">
        <div class="absolute -top-10 -right-10 h-32 w-32 bg-pink-400/20 blur-3xl"></div>
        <div class="text-sm font-semibold text-pink-700">New (30d)</div>
        <div class="text-3xl font-black mt-2 text-pink-900">
          <%= User.where("created_at >= ?", 30.days.ago).count rescue 0 %>
        </div>
        <div class="text-xs text-pink-700 mt-2">Registrations</div>
      </div>
    </div>

    <!-- USERS TABLE -->
    <div class="rounded-xl shadow-2xl border border-indigo-100/70 overflow-hidden bg-white/95">
      <div class="px-6 py-5 border-b border-indigo-100 bg-gradient-to-r from-blue-50 to-indigo-50">
        <h2 class="text-indigo-900 font-extrabold text-lg">All Users</h2>
        <p class="text-xs text-blue-400 mt-1">View, edit, and permanently delete accounts</p>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-base">
          <thead class="bg-gradient-to-r from-blue-50 to-indigo-50">
            <tr>
              <th class="px-5 py-4 font-extrabold text-cyan-800 text-sm">User</th>
              <th class="px-5 py-4 font-extrabold text-indigo-700 text-sm">Role</th>
              <th class="px-5 py-4 font-extrabold text-emerald-700 text-sm">Status</th>
              <th class="px-5 py-4 font-extrabold text-rose-700 text-sm">Joined</th>
              <th class="px-5 py-4 font-extrabold text-indigo-800 text-right text-sm">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-blue-100">
            <% if @users.blank? %>
              <tr>
                <td colspan="5" class="px-5 py-10 text-center text-blue-400 font-bold">No users found.</td>
              </tr>
            <% else %>
              <% @users.each do |u| %>
                <% role =
                  if u.respond_to?(:role) && u.role.present?
                    u.role.to_s
                  elsif u.respond_to?(:admin) && u.admin
                    "admin"
                  else
                    "customer"
                  end
                %>
                <% blocked = u.respond_to?(:blocked) ? !!u.blocked : false %>
                <%# Fancy role style %>
                <% role_class =
                  case role
                  when "admin" then "bg-indigo-200 text-indigo-800"
                  when "ceo" then "bg-yellow-200 text-yellow-700"
                  when "staff" then "bg-cyan-100 text-cyan-800"
                  else "bg-slate-100 text-slate-800"
                  end
                %>
                <% status_class = blocked ? "bg-red-200 text-red-700" : "bg-emerald-100 text-emerald-700" %>
                <tr class="hover:bg-gradient-to-l hover:from-cyan-50 hover:to-indigo-50 transition">
                  <td class="px-5 py-5">
                    <div class="flex items-center gap-3">
                      <div class="h-10 w-10 rounded-xl border border-blue-100 bg-gray-50 overflow-hidden flex items-center justify-center shadow">
                        <% if u.respond_to?(:profile_image) && u.profile_image.respond_to?(:attached?) && u.profile_image.attached? %>
                          <%= image_tag url_for(u.profile_image), class: "h-full w-full object-cover" %>
                        <% else %>
                          <span class="text-xl font-bold text-blue-800">
                            <%= (u.full_name.presence || u.email.to_s).first.to_s.upcase %>
                          </span>
                        <% end %>
                      </div>
                      <div class="min-w-0">
                        <div class="font-bold text-indigo-900 truncate"><%= u.full_name.presence || "—" %></div>
                        <div class="text-xs text-blue-400 truncate"><%= u.email %></div>
                      </div>
                    </div>
                  </td>
                  <td class="px-5 py-5">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold <%= role_class %> shadow">
                      <%= role.capitalize %>
                    </span>
                  </td>
                  <td class="px-5 py-5">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold <%= status_class %> shadow">
                      <%= blocked ? "Blocked" : "Active" %>
                    </span>
                  </td>
                  <td class="px-5 py-5 text-blue-800 font-semibold">
                    <%= u.created_at.strftime("%Y-%m-%d") rescue "—" %>
                  </td>
                  <td class="px-5 py-5 text-right min-w-[140px]">
                    <div class="flex items-center justify-end gap-2 flex-nowrap">
                      <%= link_to "View",
                            admin_user_path(u),
                            class: "px-4 py-2 rounded-full bg-blue-500 text-white font-bold border-0 shadow hover:bg-blue-600 transition" %>
                      <%= link_to "Edit",
                            edit_admin_user_path(u),
                            class: "px-4 py-2 rounded-full bg-indigo-400 text-white font-bold border-0 shadow hover:bg-indigo-500 transition" %>
                      <%= button_to "Delete",
                            admin_user_path(u),
                            method: :delete,
                            form: { data: { turbo_confirm: "Delete this user permanently? This will delete orders, addresses, etc." } },
                            class: "px-4 py-2 rounded-full bg-rose-500 text-black font-bold border-0 shadow hover:bg-rose-700 transition" %>
                    </div>
                  </td>
                </tr>
              <% end %>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>