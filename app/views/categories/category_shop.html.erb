<%# Shared "shop" template for many categories (decor, furniture, lighting, tables, new-arrivals, sale, textiles, etc.) %>
<%# Add buttons removed on category pages (read-only listing) %>

<%# --- Helpers --- %>
<% def safe_attached?(obj)
     return false unless obj.respond_to?(:attached?)
     begin
       obj.attached?
     rescue StandardError
       false
     end
   end

   def image_for(obj)
     return nil if obj.nil?
     if safe_attached?(obj)
       begin
         url_for(obj)
       rescue StandardError
         nil
       end
     else
       s = obj.to_s
       s.present? ? s : nil
     end
   end

   def category_slug
     @category.name.to_s.parameterize
   end

   # category-specific placeholder image sets
   def placeholder_images_for(slug)
     case slug
     when 'decor'
       [

       ]
     when 'furniture'
       [
         "https://images.unsplash.com/photo-1540574163026-643ea20ade25?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1493666438817-866a91353ca9?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1524758631624-e2822e304c36?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?auto=format&fit=crop&w=800&q=80"
       ]
     when 'lighting'
       [
         "https://images.unsplash.com/photo-1505691723518-11a9f8a6a1df?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1524758631624-7b5d2d1b9e0a?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1524758631624-3e9a7e6e7a6c?auto=format&fit=crop&w=800&q=80"
       ]
     when 'tables'
       [
         
         "https://images.unsplash.com/photo-1554995207-c18c203602cb?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1493809842364-78817add7ffb?auto=format&fit=crop&w=800&q=80"
       ]
     when 'new-arrivals', 'new_arrivals', 'newarrivals'
       [
         "https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1520975918479-6c0b6f0a8b7a?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1543255006-1c122d67a6d0?auto=format&fit=crop&w=800&q=80"
       ]
     when 'sale'
       [
         "https://images.unsplash.com/photo-1542291026-7eec264c27ff?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1512436991641-6745cdb1723f?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1520975918479-9a4b4f9b6c3a?auto=format&fit=crop&w=800&q=80"
       ]
     when 'textiles'
       [
         "https://images.unsplash.com/photo-1523381213953-0d0a5f2a0d1c?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1540574163026-643ea20ade25?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&w=800&q=80"
       ]
     else
       # fallback general set (men/women/children, etc.)
       [
         "https://images.unsplash.com/photo-1541099649105-f69ad21f3246?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1520975918479-9a4b4f9b6c3a?auto=format&fit=crop&w=800&q=80",
         "https://images.unsplash.com/photo-1543255006-1c122d67a6d0?auto=format&fit=crop&w=800&q=80"
       ]
     end
   end
%>

<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
  <!-- Breadcrumb + cart badge -->
  <div class="flex items-center justify-between mb-6">
    <nav class="text-sm text-gray-500" aria-label="Breadcrumb">
      <ol class="flex items-center space-x-2">
        <li><%= link_to "Home", root_path, class: "hover:underline" %></li>
        <li>/</li>
        <li><%= link_to "Categories", categories_path, class: "hover:underline" %></li>
        <li>/</li>
        <li class="text-gray-900 font-semibold"><%= @category.name %></li>
      </ol>
    </nav>

    <div>
      <a href="/cart" class="inline-flex items-center gap-2 text-sm text-gray-700 hover:text-gray-900">
        <i class="fa-solid fa-cart-shopping"></i>
        <span id="cart-count" class="inline-flex items-center justify-center bg-indigo-600 text-white rounded-full px-2 py-0.5 text-xs">
          <%= (session[:cart]&.values&.map(&:to_i)&.sum) || 0 %>
        </span>
      </a>
    </div>
  </div>

  <!-- Category hero -->
  <div class="bg-gradient-to-r from-white to-gray-50 rounded-2xl p-6 mb-8 flex flex-col md:flex-row items-center gap-6">
    <div class="flex-1">
      <h1 class="text-3xl font-extrabold text-gray-900 mb-2"><%= @category.name %></h1>
      <% if @category.description.present? %>
        <p class="text-gray-600 mb-4"><%= @category.description %></p>
      <% else %>
        <p class="text-gray-600 mb-4">Browse items in <%= @category.name %> â€” view product details from here.</p>
      <% end %>
      <div class="flex gap-3">
        <%= link_to "Shop all", category_path(@category), class: "inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-md shadow-sm hover:bg-indigo-700" %>
      </div>
    </div>

    <div class="w-full md:w-1/3">
      <% if @category.respond_to?(:image) && @category.image.present? %>
        <%= image_tag image_for(@category.image) || @category.image, alt: @category.name, class: "w-full h-40 object-cover rounded-xl shadow-sm" %>
      <% else %>
        <img src="<%= placeholder_images_for(category_slug).first %>" alt="<%= @category.name %>" class="w-full h-40 object-cover rounded-xl shadow-sm">
      <% end %>
    </div>
  </div>

  <!-- Featured / Collections grid (read-only) -->
  <section class="bg-white p-4 rounded-2xl shadow-sm mb-8">
    <h2 class="text-xl font-semibold mb-4">Featured in <%= @category.name %></h2>

    <% featured = @category.products.active.where(featured: true).limit(8) rescue [] %>
    <% if featured.blank? %>
      <% featured = @category.products.active.limit(8) rescue [] %>
    <% end %>

    <% if featured.present? %>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <% featured.each do |p| %>
          <% img_src = nil
             if p.respond_to?(:product_images) && p.product_images.any?
               img_src ||= image_for(p.product_images.first.image) rescue nil
             end
             img_src ||= (p.respond_to?(:image_url) ? p.image_url : nil)
             img_src ||= image_for(p.image) if p.respond_to?(:image)
          %>

          <div class="rounded-lg border p-3 flex flex-col bg-white">
            <%= link_to product_path(p) do %>
              <img src="<%= img_src || placeholder_images_for(category_slug).sample %>" class="w-full h-40 object-cover rounded mb-3" alt="<%= p.name %>">
            <% end %>

            <div class="font-semibold mb-1"><%= link_to p.name, product_path(p) %></div>
            <div class="text-gray-600 mb-2"><%= number_to_currency(p.price) if p.respond_to?(:price) %></div>
            <%# Add button intentionally removed for category pages %>
          </div>
        <% end %>
      </div>
    <% else %>
      <%# placeholders display without Add buttons %>
      <% placeholders = placeholder_images_for(category_slug) %>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <% placeholders.each_with_index do |img, idx| %>
          <div class="rounded-lg border p-3 flex flex-col bg-white">
            <img src="<%= img %>" class="w-full h-40 object-cover rounded mb-3" alt="<%= @category.name %> placeholder <%= idx+1 %>">
            <div class="font-semibold mb-1"><%= "#{@category.name} item #{idx + 1}" %></div>
            <div class="text-gray-600 mb-2">&nbsp;</div>
          </div>
        <% end %>
      </div>
    <% end %>
  </section>

  <!-- Full category product grid (read-only) -->
  <section class="bg-white p-4 rounded-2xl shadow-sm">
    <h2 class="text-xl font-semibold mb-4">All <%= @category.name %> Products</h2>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      <% (@products || @category.products.active.limit(24)).each do |p| %>
        <% img_src = nil
           if p.respond_to?(:product_images) && p.product_images.any?
             img_src ||= image_for(p.product_images.first.image) rescue nil
           end
           img_src ||= (p.respond_to?(:image_url) ? p.image_url : nil)
           img_src ||= image_for(p.image) if p.respond_to?(:image)
        %>

        <div class="rounded-lg border p-3 bg-white flex flex-col">
          <%= link_to product_path(p) do %>
            <img src="<%= img_src || placeholder_images_for(category_slug).sample %>" class="w-full h-40 object-cover rounded mb-3" alt="<%= p.name %>">
          <% end %>

          <div class="font-semibold"><%= link_to p.name, product_path(p) %></div>
          <div class="text-gray-600"><%= number_to_currency(p.price) if p.respond_to?(:price) %></div>

          <%# Removed Add button from category listing %>
        </div>
      <% end %>
    </div>
  </section>
</div>